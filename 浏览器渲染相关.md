# 浏览器渲染相关

<a name="wfofgf"></a>
#### [](#wfofgf)为什么操作 DOM 慢
因为 DOM 是属于渲染引擎中的东西，而 JS 又是 JS 引擎中的东西。当我们通过 JS 操作 DOM 的时候，其实这个操作涉及到了两个线程之间的通信，那么势必会带来一些性能上的损耗。操作 DOM 次数一多，也就等同于一直在进行线程之间的通信，并且操作 DOM 可能还会带来重绘回流的情况，所以也就导致了性能上的问题。

<a name="ipq7sm"></a>
#### [](#ipq7sm)渲染树是怎么生成的
渲染引擎会生成 DOM 树和 CSSOM 树，再讲这两棵树组合生成渲染树。在这一过程中，不是简单的将两者合并就行了。渲染树只会包括**需要显示的节点**和这些节点的样式信息。

<a name="bxgyob"></a>
#### [](#bxgyob)什么情况会阻塞渲染

1. 渲染的前提是生成渲染树，所以 HTML 和 CSS 肯定会阻塞渲染。如果你想渲染的越快，你越应该降低一开始需要渲染的文件**大小**，并且**扁平层级，优化选择器**。

2. 当浏览器在解析到 `script` 标签时，会暂停构建 DOM，完成后才会从暂停的地方重新开始。也就是说，如果你想首屏渲染的越快，就越不应该在首屏就加载 JS 文件，这也是都建议将 `script` 标签放在 `body` 标签底部的原因。


<a name="oi2vei"></a>
#### [](#oi2vei) script 标签一定要放在底部吗？
答案是否定的。因为你可以给 `script` 标签添加 `defer` 或者 `async` 属性。

1.  `defer` 属性表示该 JS 文件会并行下载，但是会放到 HTML 解析完成后顺序执行，所以对于这种情况你可以把 `script` 标签放在任意位置。

2. 对于没有任何依赖的 JS 文件可以加上 `async` 属性，表示 JS 文件下载和解析不会阻塞渲染。


<a name="q8lrrb"></a>
#### [](#q8lrrb)重绘和回流
重绘和回流会在我们设置节点样式时频繁出现，同时也会很大程度上影响性能。

- 重绘是当节点需要更改外观而不会影响布局的，比如改变 `color` 就叫称为重绘

- 回流是布局或者几何属性需要改变就称为回流。


回流**必定**会发生重绘，重绘**不一定**会引发回流。回流所需的成本比重绘高的多，改变父节点里的子节点很可能会导致父节点的一系列回流。

